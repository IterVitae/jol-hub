# ENTERPRISE PROMPT SPECIFICATION  
**JOL-HUB “Journey Of Life” Digital Platform**  
*Version 1.0 – 2025-12-27*  
*CalVer YY.M.minor – today 25.12.0*

---

## A. Meta Prompt – for the AI DRIVER (not for human copy-paste)
> This section is consumed by `jol-driver.py` only.  
> It tells the driver **which sub-prompt to load**, **which model to call**, **which compliance gates to enforce**, and **where to save the artefact**.

```yaml
# ========== META PROMPT (YAML) ==========
project_id: jol-hub
schema_ver: 25.12.0
generated_by: ai-driver
licence: EU-PL-1.2

pipeline:
  - phase: parish-site
    trigger:
      country: lt                    # Lithuania example
      diocese: vilnius
      parish: blessed-mykolas
      uuid: 9a3f4c12-8ee6-4e9b-9203-ff8d9b7c8f5e
    prompt_template: prompts/v25/parish-site.yaml
    model:
      llm: gpt-4o-2025-11
      temperature: 0.2
      max_tokens: 8000
    compliance:
      - gdpr
      - wcag22aa
      - canon-law-1300-1307
      - eu-digital-services-act
    outputs:
      - artefact: nextjs-site
        path: sites/lt/vilnius/blessed-mykolas-9a3f4c12/
      - artefact: bitrix24-crm-module
        path: crm-modules/lt/vilnius/blessed-mykolas-9a3f4c12.zip
      - artefact: blockchain-tx-proof
        path: ledger/25/12/25.12.0-blessed-mykolas-proof.json
    obsidian_note:
      vault: /obsidian/jol-hub/
      folder: 25-Production/2025-12/lt-vilnius/
      filename: blessed-mykolas-9a3f4c12-review.md
    bitrix24_task:
      title: "[JOL] Deploy parish site lt/vilnius/blessed-mykolas"
      group_id: 42   # pre-existing “Parish-Onboarding” workgroup
      responsible: ${diocese_coordinator_id}
      uf_crm_task_site_uuid: 9a3f4c12-8ee6-4e9b-9203-ff8d9b7c8f5e
```

---

## B. Core Prompt Templates (stored in Git)

```
repo/
├─ prompts/
│  ├─ v25/
│  │  ├─ parish-site.yaml          ← you are reading this
│  │  ├─ funeral-site.yaml
│  │  ├─ cemetery-site.yaml
│  │  ├─ blockchain-ledger.yaml
│  │  └─ seo-i18n.yaml
```

---

## C. Prompt Template `parish-site.yaml`  
*(human-readable, driver injects variables)*

### 1. Role & Context
You are a **senior full-stack engineer** and **canonical-compliance officer** building a **Next.js 15** parish site for the **Roman Catholic Diocese of {{diocese}}** in **{{country}}**.  
The site must **launch in one command**, **pass WCAG 2.2 AA**, **embed GDPR data-minimisation**, and **expose an optional blockchain donation explorer** (private-ledger, merkle-proof, gas-less).

### 2. Non-Functional Requirements
| Requirement | Metric | How to verify |
|-------------|--------|---------------|
| **Performance** | Lighthouse ≥ 95 (performance) | `npm run lighthouse` in CI |
| **Accessibility** | WCAG 2.2 AA zero violations | `axe-core` + manual keyboard |
| **SEO** | Green on Google Rich Results | Schema.org Parish, EucharistEvent, DonateAction |
| **Multilingual** | i18next ≥ 27 EU languages | `yarn build-i18n` auto-pushes to Crowdin |
| **Security** | OWASP Top-10 mitigated | SAST (Semgrep), DAST (Zap), CSP v3, Cloudflare WAF |
| **Compliance** | GDPR Art. 25 “by design” | Data-minimised forms, no US-transfer, 14-day forget |
| **Canonical** | Canon 1300-1307 compliant | Donation ledger immutable, parish owns data, JOL-HUB = processor |

### 3. Tech Stack (lockfile versions)
```
next 15.1.0
react 18.3.1
typescript 5.6
i18next 24.0.2
tailwind 3.4  (colors locked to #1D2E28 palette)
next-intl (i18n routing)
payloadcms 3.0  (as headless CMS, replaces 1C-Bitrix for new builds)
postgres 16  (diocese-schema per tenant)
redis 7.2  (session edge)
sentry 8.0  (error + perf)
open-telemetry 1.9
web3 4.6  (private ledger, no gas)
eslint 9  (canonical .eslintrc-flat)
prettier 3
```

### 4. Folder Skeleton (generated by driver)
```
sites/{{country_iso}}/{{diocese_slug}}/{{parish_slug}}-{{uuid}}/
├─ src/
│  ├─ app/[[...locale]]/   (Next.js App Router)
│  ├─ components/
│  ├─ lib/
│  ├─ styles/
│  ├─ i18n/locales/        (27 json files)
│  ├─ payload/
│  ├─ ledger/              (merkle proofs)
│  └─ tests/
├─ .env.example
├─ docker-compose.yml
├─ Dockerfile
├─ package.json
├─ tailwind.config.js  (colors locked)
├─ tsconfig.json
├─ sentry.client.config.ts
├─ sentry.server.config.ts
├─ open-telemetry.ts
└─ README-CANONICAL.md
```

### 5. Environment Variables (driver injects)
```
NEXT_PUBLIC_COUNTRY=lt
NEXT_PUBLIC_DIOCESE=vilnius
NEXT_PUBLIC_PARISH=Blessed Mykolas
NEXT_PUBLIC_UUID=9a3f4c12-8ee6-4e9b-9203-ff8d9b7c8f5e
NEXT_PUBLIC_LEDGER_RPC=https://ledger.jol-hub.com/private
DATABASE_URL=postgres://jol_9a3f4c12:${PG_PW}@pg-cluster.diocese.vilnius.lt:5432/jol_9a3f4c12
REDIS_URL=redis://redis-cluster:6379/9a3f4c12
SENTRY_DSN=https://xyz@sentry.jol-hub.com/9a3f4c12
BITRIX24_WEBHOOK=https://bitrix24.diocese.vilnius.lt/rest/42/abcdef/
```

### 6. Mandatory Pages (auto-scaffold)
1. Home – hero value prop + blockchain donation badge
2. About Us – mission, team, Catholic alignment
3. Mass Times – Payload CMS collection, i18n
4. Sacraments – online registration (GDPR forgettable)
5. Giving – private-ledger donation + pdf receipt
6. Contact – encrypted email, no 3rd-party trackers
7. Privacy & GDPR – canon-law addendum, 27-lang
8. Accessibility Statement – WCAG 2.2 AA conformance

### 7. Component Rules
- Use **Tailwind colour tokens only** (`primary-800`, `accent-gold-600`, etc.)
- **Crimson Text** for H1-H3, **Inter** for body.
- **No client-side analytics** without prior consent (GDPR Art. 6.1a).
- **No Google Fonts** – self-host for GDPR.
- **Images** ≤ 80 kB, AVIF-first, `loading="lazy"`.
- **Icons** inline SVG, `aria-label` mandatory.

### 8. Blockchain Donation Flow (private-ledger)
```
Donation ➜ POST /ledger/donate
          ➜ merkle-hash = sha256( amount ‖ currency ‖ parish-uuid ‖ donor-email-hash )
          ➜ tx stored in parish table + pushed to ledger cluster
          ➜ donor receives email with link:
             https://ledger.jol-hub.com/proof/<merkle-hash>
          ➜ explorer shows proof, no gas, no public write
```

### 9. CI / CD (GitHub Actions)
```yaml
name: parish-build
on:
  push:
    paths:
      - 'sites/lt/vilnius/blessed-mykolas-9a3f4c12/**'
jobs:
  lighthouse:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: npm ci
      - run: npm run build
      - run: npm run lighthouse
      - run: npm run axe
      - run: npm run canonical-lint   # custom rule set
  deploy:
    needs: lighthouse
    runs-on: ubuntu-latest
    steps:
      - uses: google-github-actions/deploy-cloudrun@v2
        with:
          service: parish-9a3f4c12
          image: europe-docker.pkg.dev/jol-hub/parish/9a3f4c12:${{ github.sha }}
      - run: |
          curl -X POST ${{ secrets.BITRIX24_WEBHOOK }} \
               -d "TASK_TITLE=Deploy parish-9a3f4c12&STATUS=5"
```

### 10. Observability
- **Sentry** captures FE & BE errors, auto-tags `parish_uuid`.
- **OpenTelemetry** exports to **Grafana Cloud** (EU region).
- **Uptime** checked by **Statuspage EU** every 60 s.

### 11. GDPR & Canon-Law Diary (Obsidian)
Every night the driver ETLs:
```
postgres → obsidian/25-Production/2025-12/lt-vilnius/
          blessed-mykolas-9a3f4c12-review.md
```
Template section inside note:
```markdown
## 2025-12-27
- [x] Lighthouse 97
- [x] Zero axe violations
- [x] Donation ledger tx 0x9a3f… proof saved
- [x] Bitrix24 task #84231 closed
- [ ] Bishops’ digital seal pending
```

### 12. File Naming Convention (strict regex)
```
country_iso/diocese_slug/entity-type_shortname-uuid/
└─ files:
   parish-blessed-mykolas-9a3f4c12-{component|page|style|test}.{tsx|ts|css|md}
```
- lower-kebab-case
- uuid always last segment before extension
- version NOT in filename – handled by git tags `v25.12.0`

### 13. Versioning Policy
- **CalVer** `YY.M.minor` – matches EU grant reporting quarters.
- Git tag `v25.12.0` annotated with changelog in Obsidian.
- **Immutable container tags** – never overwrite ` parish-9a3f4c12:v25.12.0`.

### 14. Secrets & Key Management
- **Google Secret Manager** – europe-west1.
- **No .env committed** – driver injects at build time.
- **Blockchain signing key** – stored in **KMS**, never in repo.

### 15. Exit Criteria (driver accepts build ONLY if)
```
✅ Lighthouse ≥ 95
✅ axe-core 0 violations
✅ GDPR forget-user endpoint 200 OK
✅ merkle-proof API 200 OK
✅ container image < 128 MB
✅ Bitrix24 webhook 200 OK
✅ git tag v25.12.x pushed
```
> All checks must pass → driver marks task “Finished” in Bitrix24 and moves card to “Live” column.

---

## D. Folder & Knowledge Storage Architecture

```
github.com/jol-hub/                       (mono-repo)
├─ prompts/                               (single source of truth)
│  └─ v25/
├─ sites/
│  └─ {iso}/{diocese}/{entity}-{uuid}/
├─ ledger/                                (private-ledger proofs)
├─ crm-modules/                           (Bitrix24 zip artefacts)
├─ terraform/                             (GCP, Cloudflare)
├─ .github/workflows/                     (CI per folder)
└─ wiki/                                  (GitHub Wiki, auto-sync Obsidian)

obsidian-vault/                           (human memory)
└─ 25-Production/
   ├─ 2025-12/
   │  ├─ lt-vilnius/
   │  │  ├─ blessed-mykolas-9a3f4c12-review.md
   │  │  └─ diary.md
   ├─ Canon-Law/
   ├─ GDPR/
   └─ Blockchain/

bitrix24-group/42/                        (task boards)
├─ Parish-Onboarding/
└─ EU-Grant-Reporting/
```

---

## E. PhpStorm / PyCharm / DataGrip Scope Files
Checked into repo:
```
jol-hub.iml
DataGrip-diocese-datasource.xml   (read-only creds)
```
> Opening the root folder auto-configures SQL dialect, ESLint, Prettier, and Tailwind tokens.

---

## F. Next Actions for You
1. Clone `github.com/jol-hub/prompts-v25`  
2. Run `jol-driver.py --country lt --diocese vilnius --parish "Blessed Mykolas"`  
3. Driver returns:  
   - GitHub PR (with CI passed)  
   - Bitrix24 task closed  
   - Obsidian diary note created  
   - Ledger proof uploaded  

---

*End of Prompt v1.0 – 25.12.0*  
*Generated by AI-Driver, digitally signed via KMS key `jol-vault-prod-25`*
